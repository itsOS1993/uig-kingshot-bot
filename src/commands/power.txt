

const { SlashCommandBuilder } = require('discord.js');
const prisma = require('../database/prisma');
const { createEmbed } = require('../utils/embed');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('power')
    .setDescription('Add power')
    .addIntegerOption(option =>
      option.setName('amount')
        .setDescription('Enter full number (example: 10000000)')
        .setRequired(true)
    )
    .addUserOption(option =>
      option.setName('user')
        .setDescription('Target user (optional)')
        .setRequired(false)
    ),

  async execute(interaction) {

    const amount = interaction.options.getInteger('amount');
    console.log("AMOUNT:", amount);
    const targetUser = interaction.options.getUser('user') || interaction.user;

    if (amount <= 0) {
      return interaction.reply({
        embeds: [createEmbed({
          description: "Amount must be greater than 0.",
          color: 0xed4245
        })],
        ephemeral: true
      });
    }

    const player = await prisma.player.findUnique({
      where: { discordId: targetUser.id }
    });

    if (!player) {
      return interaction.reply({
        embeds: [createEmbed({
          description: "User not registered.",
          color: 0xfaa61a
        })],
        ephemeral: true
      });
    }

    const updated = await prisma.player.update({
      where: { discordId: targetUser.id },
      data: {
        power: player.power + amount
      }
    });

    return interaction.reply({
      embeds: [createEmbed({
        description: `New Power: ${updated.power.toLocaleString("en-US")}`,
        color: 0x57f287
      })]
    });

  }
};
